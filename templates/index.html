<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StashLink</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingIndicator" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 5px; background-color: #e74c3c; z-index: 9999; box-shadow: 0 2px 5px rgba(231, 76, 60, 0.3);">
        <div style="height: 100%; width: 100%; background: linear-gradient(90deg, #e74c3c, #c0392b); animation: pulse 1.5s ease-in-out infinite alternate;"></div>
        <div style="position: absolute; top: 8px; left: 50%; transform: translateX(-50%); color: white; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
            ‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ, –∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞...
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
    <button class="theme-toggle" id="themeToggle">üåô</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —à–∞–±–ª–æ–Ω–∞ -->
    <div id="xlsxModal" class="modal">
        <div class="modal-content">
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω</h3>
            <select id="templateSelectForXLSX">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω --</option>
                <option value="–í —Å—Ç—Ä–æ–∫—É">–í —Å—Ç—Ä–æ–∫—É</option>
                <option value="–í —è—á–µ–π–∫—É">–í —è—á–µ–π–∫—É</option>
            </select>

            <!-- –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±–æ—Ä —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è "–í —è—á–µ–π–∫—É") -->
            <div id="separatorSection" style="display: none; margin-top: 15px;">
                <label for="separatorSelect">–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫:</label>
                <select id="separatorSelect">
                    <option value="comma">–ó–∞–ø—è—Ç–∞—è</option>
                    <option value="newline">–ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏</option>
                </select>
            </div>

            <button id="confirmXLSXBtn" class="btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            <button id="cancelXLSXBtn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <div id="imageModal" class="image-modal">
        <span class="image-modal-close" id="imageModalClose">&times;</span>
        <button class="image-modal-nav image-modal-prev" id="imageModalPrev">&#10094;</button>
        <button class="image-modal-nav image-modal-next" id="imageModalNext">&#10095;</button>
        <img class="image-modal-content" id="imageModalImg">
        <div class="image-modal-info">
            <div class="image-modal-filename" id="imageModalFilename"></div>
            <div class="image-modal-url" id="imageModalUrl"></div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="page-container">
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–¥–æ —Ñ—É—Ç–µ—Ä–∞) -->
        <div class="content-wrap">
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ -->
            <div class="container">
                <div class="upload-section">
                    <h1>–ó–∞–≥—Ä—É–∑–∫–∞ ZIP-–∞—Ä—Ö–∏–≤–∞</h1>
                    {% if error %}
                    <div class="error">{{ error }}</div>
                    {% endif %}
                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–∞ -->
                    <form method="POST" action="{{ url_for('handle_upload') }}" enctype="multipart/form-data" id="archive-form">
                        <div class="form-group">
                            <label for="album">–ò–º—è –∞–ª—å–±–æ–º–∞:</label>
                            <input type="text" id="album" name="album_name">
                            <div class="help-text">
                                üìÅ –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∏–º—è ZIP-–∞—Ä—Ö–∏–≤–∞<br>
                                –ü—Ä–∏–º–µ—Ä: archive.zip ‚Üí –ø–∞–ø–∫–∞ "archive"
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="archive">ZIP-–∞—Ä—Ö–∏–≤:</label>
                            <input type="file" id="archive" name="archive" accept=".zip">
                            <div class="help-text">
                                üìÅ –ê—Ä—Ö–∏–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–∞–ø–∫–∏ —Å –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏, –∞ –≤ –Ω–∏—Ö - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è<br>
                                –ü—Ä–∏–º–µ—Ä: archive.zip ‚Üí 100256601929 ‚Üí 100256601929_1.jpg
                            </div>
                        </div>
                        <button type="submit" class="btn">üì¶ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—Ä—Ö–∏–≤</button>
                    </form>

                    <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏ -->
                    <div class="form-separator">
                        <div class="separator-line"></div>
                    </div>

                    <h1>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</h1>
                    <form method="POST" action="{{ url_for('handle_upload') }}" enctype="multipart/form-data" id="single-form">
                        <div class="form-group">
                            <label for="product_name_single">–ò–º—è –ø—Ä–æ–¥—É–∫—Ç–∞/–∞—Ä—Ç–∏–∫—É–ª–∞:</label>
                            <input type="text" id="product_name_single" name="product_name" required>
                        </div>
                         <div class="form-group">
                            <label for="images">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                            <input type="file" id="images" name="images" multiple accept=".png,.jpg,.jpeg,.gif,.webp">
                        </div>
                        <button type="submit" class="btn">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã</button>
                    </form>
                    <!-- –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞—Ä—Ö–∏–≤" -->
                    <div style="margin-top: 20px;">
                        <a href="/admin/archive" class="btn-secondary" style="margin-bottom: 20px; display: inline-block; text-decoration: none; width: 100%; text-align: center;">
                            üì§ –ü–µ—Ä–µ–π—Ç–∏ –∫ –∞—Ä—Ö–∏–≤—É —Å—Å—ã–ª–æ–∫
                        </a>
                    </div>
                </div>
                <!-- –°–µ–∫—Ü–∏—è —Å –≥–æ—Ç–æ–≤—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ -->
                <div class="links-section">
                    <h1>–ì–æ—Ç–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏</h1>
                    {% if image_urls %}
                    <div class="url-list" id="urlList">
                        {% set current_article = None %}
                        {% for item in image_urls %}
                            {% if item.article != current_article %}
                                {% if current_article is not none %}
                                {% endif %}
                                {% set current_article = item.article %}
                            {% endif %}
                            <div class="url-item" data-url="{{ item.url }}">
                                <div class="preview-container">
                                    <img
                                        src="{{ item.thumbnail_url | default(item.url) }}"
                                        alt="Preview {{ item.filename }}"
                                        class="image-preview"
                                        loading="lazy"
                                        data-original-src="{{ item.url }}"
                                        data-filename="{{ item.filename }}"
                                        onerror="this.onerror=null; this.src='{{ item.url }}';"
                                    >
                                </div>
                                <div class="url-content">
                                    <span class="article-info">–ê—Ä—Ç–∏–∫—É–ª: {{ item.article }}</span>
                                    <div class="url-text" data-url="{{ item.url }}">
                                        {{ item.url }}
                                        <span class="copy-hint">üîó –ö–ª–∏–∫–Ω–∏—Ç–µ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
                                    </div>
                                </div>
                                <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                                <button class="delete-btn" data-url="{{ item.url }}" title="–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ñ–∞–π–ª—ã">
                                    üóëÔ∏è
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="bulk-actions">
                        <button class="btn btn-secondary" id="copyAllBtn">
                            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
                        </button>
                        <button class="btn btn-secondary" id="copyAllListBtn">
                            üìù –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫–æ–º (–ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏)
                        </button>
                        <button class="btn btn-secondary" id="triggerXLSXModalBtn">
                            üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç XLSX
                        </button>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—Ä—Ö–∏–≤ –∏–ª–∏ —Ñ–∞–π–ª—ã, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Å—ã–ª–∫–∏ –∏ –ø—Ä–µ–≤—å—é</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="footer">
            <p>–°–¥–µ–ª–∞–Ω–æ –≤ –ì–†–ê–î–ò–ï–ù–¢</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>
</html>